<div class="page">
  <header class="header">
    <h1>Add New Place</h1>
    <div class="meta">
      <span class="dot"></span>
      <span
        >{{ selected.size }} tag{{
          selected.size === 1 ? "" : "s"
        }}
        selected</span
      >
    </div>
  </header>

  <section class="card">
    <div class="section">
      <label class="label">Google Maps link</label>
      <input
        class="input"
        [(ngModel)]="mapsLink"
        (blur)="autoFill()"
        placeholder="Paste a Google Maps URL (auto-fills name & coordinates)"
      />
      <p class="help">
        Tip: paste a link like <em>https://goo.gl/maps/…</em> or any Google Maps
        place URL.
      </p>
    </div>

    <div class="grid-2">
      <div class="section">
        <label class="label">Name</label>
        <input
          class="input"
          [(ngModel)]="name"
          placeholder="e.g., Café World of Coffee"
        />
      </div>
      <div class="section">
        <label class="label"
          >Description <span class="muted">(optional)</span></label
        >
        <input
          class="input"
          [(ngModel)]="description"
          placeholder="Short note you’ll remember"
        />
      </div>
    </div>

    <div class="grid-2">
      <div class="section">
        <label class="label">Lat</label>
        <input
          class="input"
          [(ngModel)]="lat"
          type="number"
          step="0.000001"
          placeholder="41.998100"
        />
      </div>
      <div class="section">
        <label class="label">Lng</label>
        <input
          class="input"
          [(ngModel)]="lng"
          type="number"
          step="0.000001"
          placeholder="21.425400"
        />
      </div>
    </div>
  </section>

  <!-- Photos -->
  <section class="card" (paste)="onPaste($event)">
    <div class="section-title">
      <h2>Photos <span class="muted">(optional)</span></h2>
      <div class="uploader-actions">
        <label class="btn">
          <input
            type="file"
            accept="image/*"
            multiple
            hidden
            (change)="onFilesSelected($event)"
          />
          Upload images
        </label>
        <span class="paste-hint"
          >or <kbd>Ctrl</kbd> + <kbd>V</kbd> to paste</span
        >
      </div>
    </div>

    <div class="grid-photos" *ngIf="photos.length; else noPhotos">
      <div class="photo" *ngFor="let p of photos; let i = index">
        <img [src]="p.preview" alt="preview" />
        <div class="photo-actions">
          <button
            type="button"
            class="btn btn-ghost"
            (click)="removePhoto(p, i)"
          >
            Remove
          </button>
          <label class="cover">
            <input
              type="radio"
              name="cover"
              [checked]="selectedCoverIdx === i"
              (change)="selectedCoverIdx = i"
            />
            Set as cover
          </label>
        </div>
        <div class="chips compact">
          <label class="chip" *ngFor="let t of tags">
            <input
              type="checkbox"
              [checked]="p.tags.has(t)"
              (change)="togglePhotoTag(p, t, $event)"
            />
            <span>{{ t }}</span>
          </label>
        </div>
      </div>
    </div>

    <ng-template #noPhotos>
      <p class="muted">
        No photos yet. Click <strong>Upload images</strong> or just press
        <kbd>Ctrl</kbd>+<kbd>V</kbd> to paste from clipboard.
      </p>
    </ng-template>
  </section>

  <section class="card">
    <div class="section section--tight">
      <div class="section-title">
        <h2>Tags</h2>
        <button type="button" class="btn btn-ghost" (click)="selected.clear()">
          Clear all
        </button>
      </div>

      <div class="chips">
        <label class="chip" *ngFor="let t of tags">
          <input
            type="checkbox"
            [checked]="selected.has(t)"
            (change)="toggle(t, $event)"
          />
          <span>{{ t }}</span>
        </label>
      </div>
    </div>
  </section>

  <footer class="actions">
    <div class="left">
      <span *ngIf="error" class="error">{{ error }}</span>
    </div>
    <div class="right">
      <button type="button" class="btn btn-ghost" (click)="selected.clear()">
        Reset tags
      </button>
      <button
        type="button"
        class="btn btn-primary"
        [disabled]="!canSave"
        (click)="save()"
      >
        Add Place
      </button>

      <p class="hint" *ngIf="!canSave">{{ disableReason }}</p>
    </div>
  </footer>
</div>
