<div class="page">
  <header class="header">
    <h1>Edit Place</h1>
    <div class="meta">
      <span class="dot"></span>
      <span
        >{{ selected.size }} tag{{
          selected.size === 1 ? "" : "s"
        }}
        selected</span
      >
    </div>
  </header>

  <!-- Base info -->
  <section class="card">
    <div class="section">
      <label class="label">Google Maps link</label>
      <input
        class="input"
        [(ngModel)]="mapsLink"
        placeholder="Paste a Google Maps URL"
      />
    </div>

    <div class="grid-2">
      <div class="section">
        <label class="label">Name</label>
        <input class="input" [(ngModel)]="name" />
      </div>
      <div class="section">
        <label class="label"
          >Description <span class="muted">(optional)</span></label
        >
        <input class="input" [(ngModel)]="description" />
      </div>
    </div>

    <div class="grid-2">
      <div class="section">
        <label class="label">Lat</label>
        <input class="input" [(ngModel)]="lat" type="number" step="0.000001" />
      </div>
      <div class="section">
        <label class="label">Lng</label>
        <input class="input" [(ngModel)]="lng" type="number" step="0.000001" />
      </div>
    </div>
  </section>

  <!-- Existing photos -->
  <section class="card" *ngIf="existingImages.length">
    <div class="section-title">
      <h2>Existing Photos</h2>
    </div>
    <div class="grid-photos">
      <div class="photo" *ngFor="let img of existingImages">
        <img [src]="img.url" alt="existing photo" />
        <div class="photo-actions">
          <button
            type="button"
            class="btn btn-ghost"
            (click)="removeExistingImage(img)"
          >
            Remove
          </button>
          <label class="cover">
            <input
              type="radio"
              name="coverExisting"
              [checked]="coverUrl === img.url"
              (change)="onPickExistingCover(img.url)"
            />
            Set as cover
          </label>
        </div>
        <div class="chips compact">
          <label class="chip" *ngFor="let t of tags">
            <input
              type="checkbox"
              [checked]="img.tags.includes(t)"
              (change)="togglePhotoTagExisting(img, t, $event)"
            />
            <span>{{ t }}</span>
          </label>
        </div>
      </div>
    </div>
  </section>

  <!-- New uploads -->
  <section class="card" (paste)="onPaste($event)">
    <div class="section-title">
      <h2>Add New Photos</h2>
      <div class="uploader-actions">
        <label class="btn">
          <input
            type="file"
            accept="image/*"
            multiple
            hidden
            (change)="onFilesSelected($event)"
          />
          Upload images
        </label>
        <span class="paste-hint"
          >or <kbd>Ctrl</kbd> + <kbd>V</kbd> to paste</span
        >
      </div>
    </div>

    <div class="grid-photos" *ngIf="photos.length; else noNewPhotos">
      <div class="photo" *ngFor="let p of photos; let i = index">
        <img [src]="p.preview" alt="preview" />
        <div class="photo-actions">
          <button
            type="button"
            class="btn btn-ghost"
            (click)="removePhotoDraft(p, i)"
          >
            Remove
          </button>
          <label class="cover">
            <input
              type="radio"
              name="coverNew"
              [checked]="selectedNewCoverIdx === i"
              (change)="onPickNewCover(i)"
            />
            Prefer as cover
          </label>
        </div>
        <div class="chips compact">
          <label class="chip" *ngFor="let t of tags">
            <input
              type="checkbox"
              [checked]="p.tags.has(t)"
              (change)="p.tags.has(t) ? p.tags.delete(t) : p.tags.add(t)"
            />
            <span>{{ t }}</span>
          </label>
        </div>
      </div>
    </div>

    <ng-template #noNewPhotos>
      <p class="muted">No new photos yet. Upload or paste to add more.</p>
    </ng-template>
  </section>

  <!-- Place tags -->
  <section class="card">
    <div class="section-title">
      <h2>Place Tags</h2>
      <button type="button" class="btn btn-ghost" (click)="selected.clear()">
        Clear all
      </button>
    </div>
    <div class="chips">
      <label class="chip" *ngFor="let t of tags">
        <input
          type="checkbox"
          [checked]="selected.has(t)"
          (change)="toggle(t, $event)"
        />
        <span>{{ t }}</span>
      </label>
    </div>
  </section>

  <!-- Footer -->
  <footer class="actions">
    <div class="left">
      <button
        type="button"
        class="btn btn-ghost danger"
        (click)="deletePlace()"
      >
        Delete Place
      </button>
      <span *ngIf="error" class="error">{{ error }}</span>
    </div>
    <div class="right">
      <button
        type="button"
        class="btn btn-primary"
        [disabled]="!canSave"
        (click)="save()"
      >
        Save Changes
      </button>
    </div>
  </footer>
</div>
